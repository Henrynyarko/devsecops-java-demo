replicaCount: 1

agent:
  name: jenkins-agent
  image:
    repository: jenkins/inbound-agent
    tag: latest
    pullPolicy: Always
  resources:
    requests:
      cpu: "200m"
      memory: "512Mi"
    limits:
      cpu: "1"
      memory: "1Gi"

podTemplate:
  metadata:
    labels:
      app: spring-build-ci
  spec:
    containers:
      - name: maven
        image: maven:alpine
        resources:
          requests:
            cpu: "1"
            memory: "2Gi"
          limits:
            cpu: "2"
            memory: "4Gi"
        volumeMounts:
          - name: m2
            mountPath: /root/.m2/

      - name: docker-tools
        image: rmkanda/docker-tools:latest
        resources:
          requests:
            cpu: "500m"
            memory: "1Gi"
          limits:
            cpu: "2"
            memory: "2Gi"
        volumeMounts:
          - name: docker-sock
            mountPath: /var/run
          - name: trivycache
            mountPath: /tmp/trivycache/

      - name: slscan
        image: shiftleft/sast-scan
        imagePullPolicy: Always
        resources:
          requests:
            cpu: "500m"
            memory: "1Gi"
          limits:
            cpu: "2"
            memory: "2Gi"

      - name: trufflehog
        image: rmkanda/trufflehog
        resources:
          requests:
            cpu: "300m"
            memory: "512Mi"
          limits:
            cpu: "1"
            memory: "1Gi"

      - name: licensefinder
        image: licensefinder/license_finder
        resources:
          requests:
            cpu: "300m"
            memory: "512Mi"
          limits:
            cpu: "1"
            memory: "1Gi"

      - name: jnlp
        image: jenkins/inbound-agent:latest
        imagePullPolicy: Always
        tty: true
        env:
          - name: JENKINS_USER
            valueFrom:
              secretKeyRef:
                name: jenkins
                key: jenkins-admin-user
          - name: JENKINS_PASSWORD
            valueFrom:
              secretKeyRef:
                name: jenkins
                key: jenkins-admin-password
          - name: JENKINS_AGENT_NAME
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
          - name: JENKINS_URL
            value: http://jenkins.ci.svc.cluster.local:8080/
        resources:
          requests:
            cpu: "200m"
            memory: "512Mi"
          limits:
            cpu: "1"
            memory: "1Gi"
        args: ["-url", "$(JENKINS_URL)", "-credentials", "$(JENKINS_USER):$(JENKINS_PASSWORD)", "$(JENKINS_AGENT_NAME)"]

    volumes:
      - name: m2
        hostPath:
          path: /tmp/.m2/
      - name: docker-sock
        hostPath:
          path: /var/run
      - name: trivycache
        hostPath:
          path: /tmp/trivycache/
      - name: workspace-volume
        emptyDir: {}
      - name: kube-api-access
        projected:
          sources:
            - serviceAccountToken:
                path: token
                expirationSeconds: 3600
            - configMap:
                name: kube-root-ca.crt
                items:
                  - key: ca.crt
                    path: ca.crt
            - downwardAPI:
                items:
                  - path: namespace
                    fieldRef:
                      fieldPath: metadata.namespace
